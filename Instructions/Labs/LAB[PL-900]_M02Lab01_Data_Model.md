---
lab:
    title: 'Лабораторная работа 1. Моделирование данных'
    module: 'Модуль 2. Введение в Microsoft Dataverse'
---

# Модуль 2. Введение в Microsoft Dataverse
## Лабораторная работа. Моделирование данных

### Важное замечание (вступает в силу с ноября 2020 г.)
Платформа Common Data Service переименована в Microsoft Dataverse. В Microsoft Dataverse некоторые термины заменены. Например, сущность (now **таблица**), поле (now **столбец**) и запись (now **строка**) могут устареть. Имейте это в виду при выполнении заданий. Мы рассчитываем в ближайшее время полностью обновить содержимое.

Подробную информацию и полный список измененных терминов можно найти в разделе [Что такое Microsoft Dataverse?](https://docs.microsoft.com/ru-ru/powerapps/maker/common-data-service/data-platform-intro#terminology-updates)

# Сценарий

Bellows College — образовательное учреждение, имеющее на территории своего кампуса несколько зданий. Сейчас для регистрации посетителей кампуса используются бумажные журналы. Информация собирается несогласованно, отсутствуют средства сбора и анализа данных о визитах по всему кампусу. 

Администрация кампуса хотела бы модернизировать систему регистрации посетителей таким образом, чтобы допуск в здания контролировали сотрудники службы безопасности, а обитатели кампуса предварительно регистрировали все визиты и обязательно записывали их.

В этом курсе обучения вы разработаете приложения и реализуете автоматические процедуры, позволяющие администрации и службе охраны Bellows College контролировать доступ в здания кампуса. 

В этом задании вы войдете в свою среду, создадите базу данных Microsoft Dataverse и разработаете решение для отслеживания вносимых изменений. Кроме того, вы создадите модель данных, пригодную для выполнения следующих функций:

-   R1 — отслеживание мест (зданий), посещаемых в кампусе;
-   R2 — запись основной информации, позволяющей опознавать и отслеживать посетителей; 
-   R3 — планирование, регистрация визитов и управление ими. 

В конце работы вы импортируете образец данных в Microsoft Dataverse.

# Обзор этапов работы над общим заданием

Для подготовки учебных сред необходимо выполнить следующее:

* создать решение и издателя;
* добавить новые и существующие компоненты, необходимые для выполнения требуемых функций приложения. Описание метаданных (таблицы и связи) можно найти в [документе с описанием модели данных](https://github.com/MicrosoftLearning/PL-900-Microsoft-Power-Platform-Fundamentals/blob/master/Allfiles/Campus%20Management.png). Чтобы открыть этот документ в новом окне, щелкните ссылку, удерживая нажатой клавишу CTRL, либо щелкните ссылку правой кнопкой мыши.

После выполнения всех настроек в вашем решении будет несколько таблиц:

-   Контактная информация
-   Здание
-   Визит

## Предварительные требования

* Выполнить **лабораторную работу 0 модуля 0 «Проверка лабораторной среды»**.

## Что необходимо учитывать перед началом работы?

* Соглашение об именовании

* Типы данных и ограничения (например, максимальную длину имени)

* Форматы даты и времени для облегчения локализации

# Упражнение 1. Создание решения

## Задача 1. Создание решения и издателя

1.  Создание решения

    -   Перейдите по ссылке <https://make.powerapps.com>. При необходимости повторной аутентификации нажмите **Войти** и следуйте указаниям на экране.

    -   Выберите свою среду в раскрывающемся меню **Среда**, расположенном в правом верхнем углу экрана.

    -   В разделе **Решения** левого меню выберите пункт **Создать решение**.

    -   В поле **Отображаемое имя** введите строку **[Ваша фамилия]: управление кампусом**.

2.  Создание издателя

    -   В раскрывающемся меню **Издатель** выберите пункт **+ Издатель**

    -   В поле **Отображаемое имя** всплывающего окна введите **Bellows College**. 

    -   В поле **Имя** введите **BellowsCollege**.
    
    -   В поле **Префикс** введите **bc**

    -   Нажмите **Сохранить и закрыть**
    
    -   Во всплывающем окне нажмите **Готово**.

3.  Завершите создание решения.

    -   В раскрывающемся списке **Издатель** выберите вновь созданный издатель **Bellows College**.
        .

    -   Убедитесь, что в поле **Версия** установлено значение **1.0.0.0** 
    
    -   Нажмите **Создать**.

# Упражнение 2. Добавление существующих и создание новых таблиц

**Назначение:** В этом упражнении вы добавите стандартную таблицу «Контакт» и создадите в составе решения новые произвольные таблицы для зданий и визитов. 

## Задача 1. Добавление существующей таблицы

1.  Откройте только что созданное решение **Управление кампусом**.

2.  Нажмите **Добавить существующее** и выберите вариант **Таблица**.

3.  Выберите нужный **контакт**.

4.  Нажмите **Далее**.

5.  В разделе «Контакт» нажмите **Выбрать компоненты**.

6.  На вкладке **Представления** выберите **Активные контакты**. Нажмите
    **Добавить**.
    
7.  Еще раз нажмите **Выбрать компоненты**.

8.  На вкладке **Формы** выберите форму **Контакт**.
    
9.  Нажмите **Добавить**.

    > Должны быть выбраны **одно представление** и **одна форма**. 
    
10.  Еще раз нажмите **Добавить**. Таким образом в новое решение добавится таблица «Контакт» с выбранными представлением и формой.

> Теперь в ваше решение включена одна таблица «Контакт».
    
## Задача 2. Создание таблицы зданий

1.  В браузере должна быть открыта страница вашего решения «Управление кампусом». Если это не так, откройте решение «Управление кампусом», выполнив следующие действия.

    * Войдите в систему на странице <https://make.powerapps.com> (если это не сделано ранее)
    
    * Щелкните **Решения** и нажатием соответствующей кнопки выберите вновь созданное решение **[Ваша фамилия]: управление кампусом**.
          .
          
2.  Создание таблицы зданий

    -   Нажмите **Создать** и выберите **Таблица**.
    
    -   В поле **Отображаемое имя** введите **Здание** 
    
    -   Нажмите **Сохранить**. В результате запустится фоновый процесс подготовки таблицы, а вы сможете приступить к добавлению других таблиц и столбцов.

## Задача 3. Создание таблицы визитов со столбцами

В таблицу **Визит** будет заноситься информация о посещениях кампуса, в том числе информация о здании и посетителе, планируемое и фактическое время каждого визита. 

Каждому визиту желательно присвоить уникальный номер, чтобы посетитель мог просто ввести его и назвать по требованию при регистрации визита.

> При записи даты и времени мы будем использовать поведение **Независимо от часового пояса**, поскольку время визита всегда будет местным для данного здания и не будет меняться при просмотре из другого часового пояса. 

1.  В браузере должна быть открыта страница вашего решения «Управление кампусом». Если это не так, откройте решение «Управление кампусом», выполнив следующие действия.

    * Войдите в систему на странице <https://make.powerapps.com> (если это не сделано ранее)
    
    * Щелкните **Решения** и нажатием соответствующей кнопки выберите вновь созданное решение **[Ваша фамилия]: управление кампусом**.

2. Создание таблицы визитов

   * Нажмите **Создать** и выберите **Таблица**.
   
   * В поле **Отображаемое имя** введите **Визит** 
   
   * Нажмите **Сохранить**. В результате запустится фоновый процесс подготовки таблицы, а вы сможете приступить к добавлению других столбцов.

3. Создайте столбец для планируемого начала визита

   * Выберите таблицу **Визит**.

   * Выберите вкладку **Столбцы** и нажмите **Добавить столбец**.
   
   * В поле **Отображаемое имя** введите **Планируемое начало**.
   
   * В поле **Тип данных** выберите **Дата и время**.
   
   * В поле **Обязательно** выберите вариант **Обязательно**.
   
   * Разверните раздел **Расширенные параметры**.
   
   * В поле **Поведение** выберите **Независимо от часового пояса**.
   
   * Нажмите **Готово**.

4.  Создайте столбец для планируемого окончания визита

    * Нажмите **Добавить столбец**.
    
    * В поле **Отображаемое имя** введите **Планируемое окончание**.
    
    * В поле **Тип данных** выберите **Дата и время**.
    
    * В поле **Обязательно** выберите вариант **Обязательно**.
    
    * Разверните раздел **Расширенные параметры**.
    
    * В поле **Поведение** выберите **Независимо от часового пояса**.
    
    * Нажмите **Готово**.
    
5.  Создайте столбец для фактического начала визита

    * Нажмите **Добавить столбец**.
    
    * В поле **Отображаемое имя** введите **Фактическое начало**.
    
    * В поле **Тип данных** выберите **Дата и время**.
    
    * В поле **Обязательно** оставьте значение **Необязательно**.
    
    * Разверните раздел **Расширенные параметры**.
    
    * В поле **Поведение** выберите **Независимо от часового пояса**.
    
    * Нажмите **Готово**.
    
6.  Создайте столбец для фактического окончания визита

    * Нажмите **Добавить столбец**.
    
    * В поле **Отображаемое имя** введите **Фактическое окончание**.
    
    * В поле **Тип данных** выберите **Дата и время**.
    
    * В поле **Обязательно** оставьте значение **Необязательно**.
    
    * Разверните раздел **Расширенные параметры**.
    
    * В поле **Поведение** выберите **Независимо от часового пояса**.
    
    * Нажмите **Готово**.
    
7.  Создание столбца для кода

    * Нажмите **Добавить столбец**.
    
    * В поле **Отображаемое имя** введите **Код**
    
    * В поле **Тип данных** выберите **Счетчик**.
    
    * В поле **Тип счетчика** выберите **Номер с датой в качестве префикса**.
    
    * Нажмите **Готово**.
    
8.  Нажмите **Сохранить таблицу**

# Упражнение 3. Создание связей

**Назначение:** В ходе этого упражнения вы добавите связи между таблицами.

## Задача 1. Создание связей

1.  На экране должна отображаться таблица **Визит** вашего решения **Управление кампусом**. Если это не так, перейдите к данной таблице.

2.  Создайте связь визитов с контактами

    * Выберите вкладку **Связи**.
    
    * Нажмите **Добавить связь** и выберите **Многие к одному**
    
    * В поле **Связанный (один)** выберите **Контакт** 
    
    * В поле **Отображаемое имя столбца для поиска** введите **Посетитель** 
    
    * Нажмите **Готово**.
    
3.  Создайте связь визитов со зданиями

    * Нажмите **Добавить связь** и выберите **Многие к одному**
    
    * В поле **Связанный (один)** выберите **Здание** 
    
    * Нажмите **Готово**.
    
4.  Нажмите **Сохранить таблицу**

5.  Затем нажмите кнопку **Назад к решениям** в верхней левой части.

6.  Нажмите **Опубликовать все настройки**.

# Упражнение 4. Импорт данных

**Назначение:** В этом упражнении вы импортируете образец данных в базу Dataverse.

## Задача 1. Импорт решения

В этой задаче вы импортируете решение, содержащее поток Power Automate, необходимый для полного импорта данных.

1. На вашем компьютере должен быть сохранен файл **DataImport_managed.zip**. Загрузите [решение «Импорт данных»](https://github.com/MicrosoftLearning/PL-900-Microsoft-Power-Platform-Fundamentals/blob/master/Allfiles/DataImport_managed.zip?raw=true), если это не было сделано ранее.

2. Войдите в систему на странице <https://make.powerapps.com>.

3. В правом верхнем углу экрана выберите свою среду **[ваши инициалы] практика** (если она еще не выбрана).

4. В левой области навигации выберите раздел **Решения**.

5. Нажмите **Импорт**, затем **Обзор**. Найдите на своем компьютере и выберите файл **DataImport_managed.zip**, затем нажмите **Далее**.

>   Может появиться следующее сообщение:
>
>   Обнаружено отсутствие зависимостей. Перед установкой данного решения установите следующие решения...
>
>   Это сообщение указывает либо на незавершенность модели данных, либо
>   на отличие префикса издателя от **bc**, либо на несовпадение имен таблиц **зданий** и **визитов**
>   с именами, приведенными на предыдущих этапах.

6. Нажмите **Далее**. Должна появиться подсказка о восстановлении подключений. 

7. В раскрывающемся списке **Выберите подключение** выберите **+ Создать подключение**.

8. Откроется новое окно или вкладка браузера. В запросе подключения нажмите **Создать**. При необходимости войдите в систему, чтобы завершить создание подключения.

9. Закройте текущую вкладку и вернитесь на вкладку **Импорт решения**.

10. Выберите вновь созданное подключение. Если это подключение не отображается, нажмите **Обновить**, чтобы обновить список подключений. 

11. Нажмите **Импорт**.

12. Дождитесь окончания импорта.

## Задача 2. Импорт данных  

1. Откройте решение **Импорт данных**.

2. Проверьте **состояние** потока **Импорт данных**.

3. Если в поле **Состояние** отображается **Выкл.**, нажмите кнопку **[...]** рядом с надписью **Импорт данных**, затем выберите **Включить**.

   > **Важно!** Если появится сообщение об ошибке, проверьте соответствие созданных вами таблиц и столбцов с приведенными выше указаниями.

4. Откройте компонент **Импорт данных**. В новой вкладке откроется Power Automate. 

5. Нажмите **Начать** (при наличии этой опции во всплывающем окне). 

6. Нажмите **Выполнить**, затем после подсказки — **Запустить поток**.

7. Нажмите **Готово**.

8. Дождитесь окончания работы экземпляра потока. Чтобы просмотреть историю работы потока, можно обновить таблицу **Журнал выполнения за 28 дней**. 

    > Целью запуска этого потока было создание примера данных для выполнения следующих заданий. При выполнении следующей задачи вы проверите успешность импорта данных. 

## Задача 3. Проверка импорта данных

1. Вернитесь на предыдущую вкладку Power Apps. Во всплывающем окне нажмите **Готово**. 

2. На левой панели навигации выберите раздел **Решения** и откройте свое решение **Управление кампусом**.

2. Откройте таблицу **Визит** и выберите вкладку **Данные**.

3. Нажмите **Активные визиты** в правом верхнем углу, чтобы открыть переключатель представлений, затем выберите вариант **Все столбцы**. В результате изменится представление, в котором отображаются данные визита. 

    > Если кнопка **Активные визиты** не видна из-за малого разрешения экрана, на ее месте должен быть значок глаза.

    > При успешном выполнении импорта должен отобразиться список строк с данными визитов.

4. Щелкните любое значение в столбце **Здание** и убедитесь, что форма «Здание» открылась в отдельном окне. 

5. Закройте последнее открывшееся окно.

6. Щелкните любое значение в столбце **Посетитель** (может потребоваться прокрутка окна вправо) и убедитесь, что форма «Контакт» открылась в отдельном окне.

7. Закройте последнее открывшееся окно.

# Задачи повышенной сложности

* Рассмотрите возможность организации *встреч* в рамках данного решения. Что при этом изменится?
* Предложите способ обязательной установки планируемого окончания визита позже планируемого начала. 
* Предложите способ поддержки нескольких собраний в течение одного визита.
* Предложите способ защиты доступа в здание при визитах не только внешних контактов, но и внутреннего персонала.
* Предложите вариант организации посещения определенных зданий только с утверждением руководством. Как процесс получения утверждения изменит модель данных?

